人工筛选控制台改造方案
==================================================

## 目标诉求
- 过滤/审阅页按照【京内负面】【京内正面】【京外正面】【京外负面】顺序分组展示，并允许用户按需显示/隐藏某些分组。
- 审阅页不再同时展示采纳与备选，两类内容分开查看。
- 综报与晚报需要区分，允许用户将新闻归入“综报采纳/备选”或“晚报采纳/备选”，并讨论最佳落地方式。

## 现状梳理
- 数据与服务
  - `manual_reviews.status` 取值为 pending/selected/backup/discarded/exported，尚无报型字段。
  - `list_candidates(cluster=True)` 会按 `is_beijing_related` + `sentiment_label` 聚类；桶顺序目前是京内正面→京内负面→京外正面→京外负面（dict 插入序保持）。
  - `list_review(decision)` 分别拉取 selected 与 backup 列表，前端同时渲染两列。
  - 导出 `export_batch(template=zongbao|wanbao)` 默认读取全部 selected，未区分综报/晚报。
- 前端
  - 筛选页左侧仅能单选一个类别（按钮+API 查询参数 region/sentiment），无法同屏多类别或隐藏特定类别。
  - 聚类结果在前端按返回顺序渲染，未显式排序指定分组顺序。
  - 审阅页双列同时展示采纳/备选，移动端有单列切换；状态变更、排序等操作基于当前 DOM。

## 拟议调整
- 分组顺序与显隐
  - 服务侧：在 `cluster_pending` 统一使用固定桶顺序 `[京内负面, 京内正面, 京外正面, 京外负面]` 产出 clusters；必要时在非聚类路径同样按此顺序排序。
  - 前端：筛选页改为“分组块 + 复选显隐”模式，默认四组全开；切换复选框仅控制前端显示，不额外触发请求，减轻 API 复杂度。保留按页刷新与分组内聚类展开交互。
  - 在筛选侧边栏或工具条增加“显示分组”控件（四个开关），并标记分组计数/颜色，顺序固定为诉求顺序。
- 审阅页单列视图
  - 将采纳/备选切换改为 tab/单选切换，任何时刻只渲染一个列表；切换时发起对应 API 请求或复用已加载数据。
  - 保留排序/批量状态变更/摘要编辑能力；在切换时刷新计数，确保不会对另一列表产生误操作。
- 综报 vs 晚报（需讨论后落地）
  - 数据模型候选：
    1) 在 `manual_reviews` 增加 `report_type`（enum：zongbao/wanbao/null）并将 status 拆为组合，如 selected+report_type。导出、审阅、排序、批量操作需带上 report_type 过滤。
    2) 保持 status 不变，新增“分组标签”字段（例如 `review_bucket`）标记报型；导出时按报型过滤，审阅页提供切换标签的 UI。
  - 前端交互候选：
    - 筛选阶段：在每条/每簇操作时选择目标报型（默认综报，可批量改），或在顶部选择当前“工作报型”作为默认写入。
    - 审阅阶段：在 tab 维度加入报型切换（综报/晚报），内部再分采纳/备选；或提供双重切换（报型 -> 状态）。
  - 导出：`export` 接口需要按报型筛选 selected，或允许分别导出综报/晚报；期号元数据可能需要为两套分别记录。

## 开发步骤草案
- 后端
  - 调整 `cluster_pending`（及必要的列表接口）使用固定桶顺序并在响应中附带分组 key，方便前端显隐。
  - 评估报型字段方案并设计迁移（SQL、adapter、service schema），扩展 API 请求/响应结构。
  - 导出逻辑按报型过滤，期号元数据如需拆分则为不同模板/报型维护独立计数。
- 前端
  - 筛选页：替换侧栏单选为分组显隐开关 + 分组模块渲染；无数据时在分组内展示空态，保留批量放弃逻辑。
  - 审阅页：改为单列视图，提供采纳/备选切换（和后续的报型切换）；更新排序和批量交互的 DOM 范围。
  - 报型切换：在筛选、审阅、导出 UI 中增加综报/晚报的选择方式，与后端字段对齐。
  - 样式：为分组显隐控件与单列视图补充样式，确保移动端适配。
- 测试/验证
  - 手测：分组显隐、聚类展开、批量放弃、排序/拖拽、导出预览与落盘、切换报型后的状态持久化。
  - 单元/集成：如后端改 schema，补充 service 层 bucket 排序、报型过滤的测试。

## 待确认问题
1) 报型规则：一条新闻是否允许同时属于综报和晚报？如果不允许，切换报型时需要自动迁移/互斥处理吗？已有采纳/备选记录默认归入哪一类？
2) 操作入口：报型是作为“全局当前报型”统一应用于本次操作，还是每条/每簇独立可选？是否需要批量修改报型的能力？
3) 导出：综报与晚报需要同时导出吗？期号/总期号是两套独立累加还是共用一套计数？
4) 分组显隐：隐藏某分组时是否需要影响总数统计，还是仅前端展示层隐藏但仍保留计数？
5) 审阅页数据量：单列模式下需要分页吗，还是继续一次性取前 50 条即可？

如有偏好或约束，请告知，我会按定稿方案细化实现计划与拆分任务。
