人工筛选控制台 - 审阅页改造方案
==================================================

## 目标（仅审阅页）
- 审阅页按【京内负面】【京内正面】【京外正面】【京外负面】顺序分组展示，并允许用户前端显示/隐藏分组（不影响统计）。
- 采纳与备选分开查看，不同报型（综报/晚报）也能分开查看；审阅页同时存在四个分类：综报采纳、综报备选、晚报采纳、晚报备选。
- 每条新闻只能归入一种报型；筛选页沿用现状，点击采纳/备选默认归入综报；审阅页提供切换报型的入口（可配合全选）。
- 导出仍各自进行，综报/晚报的期号与总期号各自独立累加。

## 现状（与审阅相关）
- 数据：`manual_reviews.status` 仅有 pending/selected/backup/discarded/exported，暂无报型字段，`list_review(decision)` 不区分报型。
- 前端：审阅页当前同时渲染采纳、备选两列（移动端单列切换），未区分报型，也未按京内/京外+情感分组。

## 设计方向
- 数据模型
  - 增加 `report_type` 字段（enum：`zongbao`/`wanbao`/`null`）并在审阅、导出、更新状态时携带。
  - 状态仍用 selected/backup/discarded/pending/exported，但查询/更新时按 report_type 过滤，避免一条同时属于两报型。
  - 默认写入：筛选页的采纳/备选操作写 `report_type=zongbao`，审阅页可单条/多选切换报型。
- 审阅页交互
  - 视图区：双层切换 —— 报型（综报/晚报） + 状态（采纳/备选），同一时刻只展示一个列表，保留排序拖拽/批量状态/摘要编辑。
  - 分组与显隐：列表内按【京内负面→京内正面→京外正面→京外负面】分组显示；增加“显示分组”开关（仅前端控制显示，不改统计）。
  - 全选/批量：全选作用于当前视图；批量状态/报型切换时应用当前选中项。
  - 计数：顶部统计继续汇总全量（不受显隐影响），视图内可显示当前报型+状态的数量。
- 导出/期号
  - 导出接口按 `report_type` 过滤 selected；期号/总期号各自维护（两套元数据）。
  - 已有导出模板参数 `template=zongbao|wanbao` 与期号字段可直接映射；需要把报型写入记录，防止混淆。

## 实施步骤草案
- 后端
  - Schema：为 `manual_reviews` 增加 `report_type`（默认 null->视为综报或显式设定），添加索引（status, report_type, rank）。
  - Service/API：`list_review`、`bulk_decide`、`update_ranks`、`save_edits` 支持 `report_type` 过滤/更新；`export_batch` 按报型过滤 selected 并独立维护期号元数据。
  - 迁移：既有记录默认设为综报（与现有导出一致）；确保导出标记/状态更新不会跨报型串联。
- 前端（仅审阅页）
  - 视图切换：增加报型切换（tabs/segmented control）+ 状态切换（采纳/备选），单视图渲染。
  - 分组渲染与显隐：按固定顺序分组，提供前端显隐开关，隐藏不影响计数。
  - 批量操作：全选/批量状态切换在当前视图生效；提供批量报型切换入口（沿用现有选框）。
  - 排序与拖拽：在单视图下保持 sortable；切换视图时重新初始化排序容器。
  - 默认报型：在审阅页新增单条/多选的报型切换控件，筛选页保持默认综报，不新增操作入口。
- 验证
  - 手测：报型切换、分组显隐、排序拖拽、批量状态/报型切换、导出分别针对综报/晚报、统计刷新。
  - 如增加后端字段，补充 service 层测试覆盖报型过滤与期号分离。

## 已确认点
- 一条新闻只能属于一个报型；四个分类（综报采纳/备选、晚报采纳/备选）可同时存在不同新闻。
- 筛选页点击采纳/备选默认写综报；审阅页需提供报型切换入口，支持配合全选。
- 综报与晚报不需同批导出；两套期号各自累加。
- 分组显隐仅影响展示，不改统计。
- 审阅页数据量维持现状（一次拉取当前列表即可）。

## 开发步骤（实施顺序）
1) 后端数据层
   - 为 `manual_reviews` 增加 `report_type`（enum: zongbao/wanbao/null，默认视为 zongbao），补充索引（status, report_type, rank），编写迁移脚本，将现有记录填充为 zongbao。
   - Adapter/Service：`list_review`、`bulk_decide`、`update_ranks`、`save_edits`、`export_batch` 增加 `report_type` 参数；导出期号元数据按报型分桶存储。
2) API 层
   - 路由 `/api/manual_filter/review` 等接口支持 `report_type` 查询；`decide`/`order`/`edit` 请求体透传报型。
   - 返回结构可附带分组字段（region+sentiment）便于前端分组显示。
3) 前端审阅页
   - 视图切换：新增报型切换控件（综报/晚报）+ 状态切换（采纳/备选），同一时间仅渲染一个列表；切换时请求对应数据。
   - 分组与显隐：按固定顺序【京内负面→京内正面→京外正面→京外负面】分组渲染；提供分组开关（仅前端隐藏显示，不改计数）。
   - 批量/单条操作：全选作用于当前视图；支持批量状态切换、批量报型切换（结合已有选框）；单条可改报型/状态并保存摘要与来源。
   - 排序：在当前视图保持拖拽排序，切换视图时重建 Sortable 并调用 `order` 接口带上报型。
4) 导出与验证
   - 导出对接报型：导出请求带 `report_type` 或使用 template→报型映射，确保只导出对应报型的 selected，并使用该报型的期号计数。
   - 手测场景：报型切换后编辑/排序/批量状态生效；分组显隐仅影响展示；导出综报/晚报分别正确落盘与期号递增。若有测试框架，补 service 层报型过滤与期号分桶的单元测试。
